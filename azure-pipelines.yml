# Node.js with Angular
# Build a Node.js project that uses Angular.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
  - master

pool:
  vmImage: 'windows-latest'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '10.x'
    displayName: 'Install Node.js'

  - script: |
      npm install -g @angular/cli
      npm install -g @ionic/cli
      npm install --save @capacitor/core @capacitor/cli
      npm install
      ionic build
      npx cap add android
    workingDirectory: ./RepClient
    displayName: 'npm install and ionic build'

  - task: CmdLine@2
    inputs:
      workingDirectory: ./android
      script: './gradlew assembleDebug' 
    displayName: 'Gradle AssembleDebug '

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: $(System.DefaultWorkingDirectory)/RepClient/android/app/build/outputs/apk/debug
      artifactName: 'app-debug.apk'

  - task: AzureFileCopy@1
    inputs:
      SourcePath: '$(Build.SourcesDirectory)'
      azureSubscription: 'Pay-As-You-Go(ef03e228-1cbf-4781-b858-977cc79e1e6e)'
      Destination: 'AzureBlob'
      storage: 'csb10032000acbf47f5'
      ContainerName: 'repclient-dev'


    

